<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="UTF-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>

		<title>
			{% block title %}Mi Tienda MPJ{% endblock %}
		</title>

		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

		<link
		  rel="stylesheet"
		  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
		  referrerpolicy="no-referrer"
		/>

		<style>
			html, body { background: #fff !important; min-height: 100%; }

			/* Lupa y botón Admin */
			.btn-lupa,
			.btn-admin {
				border: 0;
				background: transparent;
				color: #fff;
				padding: 6px 10px;
				line-height: 1;
				cursor: pointer;
				display: inline-flex;
				align-items: center;
				justify-content: center;
				font-size: 13px;
				font-weight: 500;
				text-transform: uppercase;
				letter-spacing: 0.05em;
			}
			.btn-lupa i,
			.btn-admin i { font-size: 16px; opacity: .9; margin-right: 4px; }
			.btn-lupa:hover,
			.btn-admin:hover { opacity: .85; }

			/* Para que no tape el navbar fixed */
			main.container { padding-top: 80px; }

			.nav-link i { transition: opacity .15s ease; }
			.nav-link:hover i { opacity: .8; }

			.dropdown .nav-link { text-decoration: none; }
			.dropdown .nav-link:focus { box-shadow: none; }

			/* Espaciado fino entre acciones del header */
			.header-acciones > * { margin-left: 18px; }
		</style>

		<link rel="stylesheet" href="/build/app.css">
		{% block stylesheets %}{% endblock %}
	</head>

	<body>
		<header>
			<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
				<div class="container-fluid px-4">

					<div class="d-flex align-items-center">
						<a class="navbar-brand me-4" href="{{ path('home') }}">
							<img src="{{ asset('images/logo.png') }}" alt="MPJ" style="height: 28px;">
						</a>

						<ul class="navbar-nav mb-2 mb-lg-0">
							<li class="nav-item">
								<a class="nav-link" href="{{ path('producto_listado') }}">
									Productos
								</a>
							</li>
						</ul>
					</div>

					<div class="d-flex align-items-center gap-4 ms-auto header-acciones">

						{# BOTÓN ADMIN integrado con iconos #}
						{% if app.user and 'ROLE_ADMIN' in app.user.roles %}
							<a class="btn-admin text-white" href="{{ path('admin_dashboard') }}" title="Panel Admin">
								<i class="bi bi-speedometer2"></i> Admin
							</a>
						{% endif %}

						{# BUSCAR #}
						<button type="button" class="btn-lupa" id="btn-abrir-buscador" aria-label="Abrir buscador">
							<i class="fa-solid fa-magnifying-glass"></i>
							<span>Buscar</span>
						</button>

						{# CARRITO #}
						{% set carrito = app.session.get('carrito', []) %}
						{% set totalCarrito = 0 %}
						{% for item in carrito %}
							{% set totalCarrito = totalCarrito + item.cantidad %}
						{% endfor %}
						<a class="nav-link position-relative text-white" href="{{ path('carrito_ver') }}" title="Carrito">
							<i class="bi bi-cart3 fs-5"></i>
							{% if totalCarrito > 0 %}
								<span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
									{{ totalCarrito }}
								</span>
							{% endif %}
						</a>

						{# PERFIL / LOGIN #}
						{% if app.user %}
							<div class="dropdown">
								<button class="btn btn-dark dropdown-toggle d-flex align-items-center gap-2" data-bs-toggle="dropdown" aria-expanded="false">
									<i class="bi bi-person-circle fs-5"></i>
								</button>
								<ul class="dropdown-menu dropdown-menu-end">
									<li><a class="dropdown-item" href="{{ path('perfil') }}">Mi perfil</a></li>
									<li><hr class="dropdown-divider"></li>
									<li><a class="dropdown-item text-danger" href="{{ path('app_logout') }}">Cerrar sesión</a></li>
								</ul>
							</div>
						{% else %}
							<a class="btn btn-outline-light btn-sm" href="{{ path('app_login') }}">Iniciar sesión</a>
						{% endif %}
					</div>
				</div>
			</nav>

			<div id="react-buscador-avanzado"></div>
		</header>

		{% block hero %}{% endblock %}

		<main class="container mt-4">
			{% block body %}{% endblock %}
		</main>

		<footer class="text-center mt-4 mb-4">
			<p>© 2025 Mi Tienda MPJ - Todos los derechos reservados</p>
		</footer>

		<script src="/build/runtime.js"></script>
		<script src="/build/app.js"></script>

		{% block javascripts %}{% endblock %}
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	</body>
</html>
