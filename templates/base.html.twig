<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="UTF-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>

		<title>
			{% block title %}Mi Tienda MPJ{% endblock %}
		</title>

		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

		<style>
			html, body { background: #fff !important; min-height: 100%; }

			/* Bot√≥n lupa estilo Zara */
			.btn-lupa {
				border: 0;
				background: transparent;
				color: #fff;
				padding: 6px 10px;
				line-height: 1;
				font-size: 18px;
				cursor: pointer;
			}
			.btn-lupa:hover { opacity: .85; }
		</style>

		{% block stylesheets %}
			{{ encore_entry_link_tags('app') }}
		{% endblock %}
	</head>

	<body>
		<header>
			<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
				<div class="container">
					<a class="navbar-brand" href="{{ path('producto_listado') }}">Mi Tienda MPJ</a>

					<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMPJ">
						<span class="navbar-toggler-icon"></span>
					</button>

					<div class="collapse navbar-collapse" id="navbarMPJ">
						<ul class="navbar-nav me-auto mb-2 mb-lg-0">
							<li class="nav-item">
								<a class="nav-link" href="{{ path('producto_listado') }}">Productos</a>
							</li>

							<li class="nav-item">
								{% set carrito = app.session.get('carrito', []) %}
								{% set totalCarrito = 0 %}
								{% for item in carrito %}
									{% set totalCarrito = totalCarrito + item.cantidad %}
								{% endfor %}

								<a class="nav-link" href="{{ path('carrito_ver') }}">
									Carrito
									{% if totalCarrito > 0 %}
										<span class="badge bg-danger ms-1">{{ totalCarrito }}</span>
									{% endif %}
								</a>
							</li>
						</ul>

						<div class="d-flex align-items-center gap-2">
							{# ‚úÖ NUEVO: bot√≥n lupa que abre el overlay React #}
							<button
								type="button"
								class="btn-lupa"
								id="btn-abrir-buscador"
								aria-label="Abrir buscador"
								title="Buscar"
							>üîç</button>

							{% if app.user %}
								<a href="{{ path('perfil') }}" class="nav-link text-white me-2">Perfil</a>

								<span class="navbar-text text-muted small me-2">
									{{ app.user.email }}
								</span>

								<a href="{{ path('app_logout') }}" class="btn btn-outline-light btn-sm">
									Cerrar sesi√≥n
								</a>
							{% else %}
								<a class="btn btn-outline-light" href="{{ path('app_login') }}">Iniciar sesi√≥n</a>
							{% endif %}
						</div>
					</div>
				</div>
			</nav>

			{# ‚úÖ Contenedor React: aqu√≠ se monta el overlay (no debe ocupar espacio) #}
			<div id="react-buscador-avanzado"></div>
		</header>

		<main class="container mt-4">
			{% block body %}{% endblock %}
		</main>

		<footer class="text-center mt-4 mb-4">
			<p>¬© 2025 Mi Tienda MPJ - Todos los derechos reservados</p>
		</footer>

		<script src="/build/runtime.js"></script>
		<script src="/build/app.js"></script>
		<link rel="stylesheet" href="/build/app.css">

		{{ encore_entry_script_tags('app') }}
		{% block javascripts %}{% endblock %}

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	</body>
</html>
