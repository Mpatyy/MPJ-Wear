<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="UTF-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>

		<title>
			{% block title %}Mi Tienda MPJ{% endblock %}
		</title>

		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

		{# ✅ Font Awesome (lupa profesional) #}
		<link
		  rel="stylesheet"
		  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
		  referrerpolicy="no-referrer"
		/>

		<style>
			html, body { background: #fff !important; min-height: 100%; }

			/* Lupa */
			.btn-lupa {
				border: 0;
				background: transparent;
				color: #fff;
				padding: 6px 10px;
				line-height: 1;
				cursor: pointer;
				display: inline-flex;
				align-items: center;
				justify-content: center;
			}
			.btn-lupa i { font-size: 16px; opacity: .9; }
			.btn-lupa:hover { opacity: .85; }

			/* Para que no tape el navbar fixed */
			main.container {
				padding-top: 80px;
			}

			.nav-link i {
				transition: opacity .15s ease;
			}
			.nav-link:hover i {
				opacity: .8;
			}

			/* Dropdown perfil: que no parezca link azul raro */
			.dropdown .nav-link {
				text-decoration: none;
			}
			.dropdown .nav-link:focus {
				box-shadow: none;
			}
		</style>

		{# ✅ Carga CSS del build (una sola vez) #}
		<link rel="stylesheet" href="/build/app.css">
		{% block stylesheets %}{% endblock %}
	</head>

	<body>
		<header>
			<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
				<div class="container">
					<a class="navbar-brand" href="{{ path('producto_listado') }}">Mi Tienda MPJ</a>

					<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMPJ">
						<span class="navbar-toggler-icon"></span>
					</button>

					<div class="collapse navbar-collapse" id="navbarMPJ">
						<ul class="navbar-nav me-auto mb-2 mb-lg-0">
							<li class="nav-item">
								<a class="nav-link" href="{{ path('producto_listado') }}">Productos</a>
							</li>
						</ul>

						<div class="d-flex align-items-center gap-2">

							{# ✅ Lupa (abre el overlay React) #}
							<button
								type="button"
								class="btn-lupa"
								id="btn-abrir-buscador"
								aria-label="Abrir buscador"
								title="Buscar"
							>
								<i class="fa-solid fa-magnifying-glass"></i>
							</button>

							{# ✅ Carrito al lado de la lupa #}
							{% set carrito = app.session.get('carrito', []) %}
							{% set totalCarrito = 0 %}
							{% for item in carrito %}
								{% set totalCarrito = totalCarrito + item.cantidad %}
							{% endfor %}

							<a class="nav-link position-relative text-white me-2" href="{{ path('carrito_ver') }}" title="Carrito">
								<i class="bi bi-cart3 fs-5"></i>

								{% if totalCarrito > 0 %}
									<span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
										{{ totalCarrito }}
									</span>
								{% endif %}
							</a>

							{% if app.user %}
								{# ✅ Dropdown perfil con icono #}
								<div class="dropdown">
									<button
										class="btn btn-link nav-link text-white p-0 d-inline-flex align-items-center gap-1"
										type="button"
										id="dropdownPerfil"
										data-bs-toggle="dropdown"
										aria-expanded="false"
										title="Cuenta"
									>
										<i class="bi bi-person-circle fs-5"></i>
										<i class="bi bi-chevron-down small"></i>
									</button>

									<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownPerfil">
										<li class="px-3 py-2">
											<div class="small text-muted">Sesión iniciada como</div>
											<div class="fw-semibold small">{{ app.user.email }}</div>
										</li>

										<li><hr class="dropdown-divider"></li>

										<li>
											<a class="dropdown-item" href="{{ path('perfil') }}">
												<i class="bi bi-person me-2"></i> Perfil
											</a>
										</li>

										{# ✅ Opcional si tienes una ruta de pedidos #}
										{#
										<li>
											<a class="dropdown-item" href="{{ path('pedido_listado') }}">
												<i class="bi bi-receipt me-2"></i> Mis pedidos
											</a>
										</li>
										#}

										<li><hr class="dropdown-divider"></li>

										<li>
											<a class="dropdown-item text-danger" href="{{ path('app_logout') }}">
												<i class="bi bi-box-arrow-right me-2"></i> Cerrar sesión
											</a>
										</li>
									</ul>
								</div>

							{% else %}
								<a class="btn btn-outline-light" href="{{ path('app_login') }}">Iniciar sesión</a>
							{% endif %}
						</div>
					</div>
				</div>
			</nav>

			{# ✅ Contenedor React: aquí se monta el overlay #}
			<div id="react-buscador-avanzado"></div>
		</header>

		{% block hero %}{% endblock %}

		<main class="container mt-4">
			{% block body %}{% endblock %}
		</main>

		<footer class="text-center mt-4 mb-4">
			<p>© 2025 Mi Tienda MPJ - Todos los derechos reservados</p>
		</footer>

		{# ✅ Carga JS del build (una sola vez) #}
		<script src="/build/runtime.js"></script>
		<script src="/build/app.js"></script>

		{% block javascripts %}{% endblock %}

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	</body>
</html>
