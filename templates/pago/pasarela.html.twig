{% extends 'base.html.twig' %}

{% block title %}Pasarela de pago{% endblock %}

{% block body %}
<h1 class="mb-4">Pago seguro</h1>
{% for linea in pedido.lineas %}
    <div class="item-pago">
        {% if linea.imagen %}
            <img src="{{ asset(linea.imagen) }}" alt="{{ linea.producto.nombre }}" width="80">
        {% endif %}
        {{ linea.producto.nombre }} ({{ linea.talla }} / {{ linea.color }}) x {{ linea.cantidad }} - {{ linea.subtotal }} €
    </div>
{% endfor %}

{% for message in app.flashes('error') %}
    <div class="alert alert-danger">{{ message }}</div>
{% endfor %}

<form action="{{ path('pago_procesar') }}" method="post" class="col-md-6">

    <div class="mb-3">
        <label class="form-label">Número de tarjeta</label>
        <input
            type="text"
            name="numero_tarjeta"
            class="form-control"
            maxlength="16"
            pattern="\d{16}"
            inputmode="numeric"
            required
        >
    </div>

    <div class="mb-3">
        <label class="form-label">Fecha de caducidad (MM/YY)</label>
        <input
            type="text"
            name="fecha_caducidad"
            id="fecha_caducidad"
            class="form-control"
            maxlength="5"
            inputmode="numeric"
            placeholder="MMYY"
            required
        >
        <small class="text-muted">
            Escribe solo números (ej: 0527)
        </small>
    </div>

    <div class="mb-3">
        <label class="form-label">CVV</label>
        <input
            type="password"
            name="cvv"
            class="form-control"
            maxlength="3"
            pattern="\d{3}"
            inputmode="numeric"
            required
        >
    </div>

    <button type="submit" class="btn btn-success">
        Realizar pago
    </button>
</form>

<script>
document.getElementById('fecha_caducidad').addEventListener('input', function (e) {
    let value = e.target.value.replace(/\D/g, '');

    if (value.length >= 3) {
        value = value.substring(0, 2) + '/' + value.substring(2, 4);
    }

    e.target.value = value;
});
</script>
{% endblock %}
